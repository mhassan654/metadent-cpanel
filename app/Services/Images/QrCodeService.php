<?php

namespace App\Services\Images;

use SVG\SVG;
use App\Helpers\Helper;
use Endroid\QrCode\Writer\PngWriter;
use Illuminate\Support\Facades\File;

class QrCodeService
{

    public static function storeImage(string $qr_code_url)
    {
        $folder_path = "/uploads/images/email/";

        $directory_path = public_path($folder_path);

        $writer = new PngWriter();
        $qrCode = new \Endroid\QrCode\QrCode($qr_code_url);
        $qrCode->setSize(200);
        $result = $writer->write($qrCode);

        $filename = Helper::file_name();

        $local_url = $filename . ".png";

        $filepath = $directory_path . $local_url;

        if (!File::isDirectory($directory_path)) {
            File::makeDirectory($directory_path, 0777, true, true);
        }

        $result->saveToFile($filepath);

        $uri = $result->getDataUri();

        $file_url = url('/') . $folder_path . $local_url;

        // if (request()->getHost() == "127.0.0.1") {
        //     $file_url = str_replace('https', 'http', $file_url);
        // }

        return [
            'filepath' => $file_url,
            'uri' => $uri
        ];
    }


    public static function createFileFromSVG($data, $filename)
    {
        $file_url = "";
        $image = str_replace('data:image/png;base64,', '', $data);
        $image = str_replace(' ', '+', $image);
        $imageName = $filename . '.png';

        $folder_path = "/uploads/images/svg/";

        $final_folder_path = public_path("/uploads/images/svg/");

        if (!File::isDirectory($final_folder_path)) {
            File::makeDirectory($final_folder_path, 0777, true, true);
        }

        if (File::put($final_folder_path . $imageName, base64_decode($image))) {
            $file_url = url('/') . $folder_path . $imageName;
        }
        return $file_url;
    }

    public static function generateSVG()
    {
        $svg = '<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="200" height="200" viewBox="0 0 200 200"><rect x="0" y="0" width="200" height="200" fill="#fefefe"/><g transform="scale(4.082)"><g transform="translate(4,4)"><path fill-rule="evenodd" d="M9 0L9 1L8 1L8 2L9 2L9 3L8 3L8 4L9 4L9 3L10 3L10 5L8 5L8 7L9 7L9 6L10 6L10 7L11 7L11 8L10 8L10 9L9 9L9 8L6 8L6 9L5 9L5 8L0 8L0 9L1 9L1 10L4 10L4 11L5 11L5 10L6 10L6 11L7 11L7 12L3 12L3 11L2 11L2 12L0 12L0 13L1 13L1 14L0 14L0 15L2 15L2 16L3 16L3 17L0 17L0 18L2 18L2 19L3 19L3 20L2 20L2 22L1 22L1 21L0 21L0 24L3 24L3 21L4 21L4 19L7 19L7 20L6 20L6 21L5 21L5 23L4 23L4 25L3 25L3 26L2 26L2 27L3 27L3 26L4 26L4 25L5 25L5 24L6 24L6 25L8 25L8 26L5 26L5 27L4 27L4 28L3 28L3 30L2 30L2 29L1 29L1 27L0 27L0 33L1 33L1 30L2 30L2 32L3 32L3 33L7 33L7 32L5 32L5 31L8 31L8 30L5 30L5 29L8 29L8 28L6 28L6 27L9 27L9 28L10 28L10 29L9 29L9 30L10 30L10 31L11 31L11 33L10 33L10 34L13 34L13 35L11 35L11 36L10 36L10 35L9 35L9 33L8 33L8 35L9 35L9 36L8 36L8 41L9 41L9 39L10 39L10 41L11 41L11 39L10 39L10 37L11 37L11 36L14 36L14 37L15 37L15 39L14 39L14 38L13 38L13 37L12 37L12 38L13 38L13 39L12 39L12 41L13 41L13 39L14 39L14 41L17 41L17 39L18 39L18 40L21 40L21 41L23 41L23 40L25 40L25 39L28 39L28 38L29 38L29 41L30 41L30 40L31 40L31 39L32 39L32 40L33 40L33 39L32 39L32 38L33 38L33 37L34 37L34 39L35 39L35 40L34 40L34 41L38 41L38 39L37 39L37 38L38 38L38 35L40 35L40 34L41 34L41 31L36 31L36 32L35 32L35 31L33 31L33 28L37 28L37 29L35 29L35 30L38 30L38 28L37 28L37 27L33 27L33 26L34 26L34 25L33 25L33 26L32 26L32 27L30 27L30 26L31 26L31 25L30 25L30 26L28 26L28 27L29 27L29 28L27 28L27 30L25 30L25 29L23 29L23 28L26 28L26 27L27 27L27 26L25 26L25 27L23 27L23 24L22 24L22 23L25 23L25 24L24 24L24 25L26 25L26 23L27 23L27 22L29 22L29 21L28 21L28 20L29 20L29 19L30 19L30 20L32 20L32 22L31 22L31 23L30 23L30 24L31 24L31 23L32 23L32 24L33 24L33 23L32 23L32 22L33 22L33 20L32 20L32 18L33 18L33 16L34 16L34 18L35 18L35 19L34 19L34 20L35 20L35 21L37 21L37 22L38 22L38 21L37 21L37 19L39 19L39 20L40 20L40 19L41 19L41 17L40 17L40 18L38 18L38 15L39 15L39 16L41 16L41 13L40 13L40 15L39 15L39 14L37 14L37 13L36 13L36 12L38 12L38 11L40 11L40 10L41 10L41 9L40 9L40 8L39 8L39 9L40 9L40 10L38 10L38 8L37 8L37 11L36 11L36 12L35 12L35 11L34 11L34 12L33 12L33 11L32 11L32 10L33 10L33 9L34 9L34 10L36 10L36 8L35 8L35 9L34 9L34 8L33 8L33 4L32 4L32 7L31 7L31 6L30 6L30 5L29 5L29 2L30 2L30 4L31 4L31 3L33 3L33 2L30 2L30 1L29 1L29 2L28 2L28 0L26 0L26 1L25 1L25 0L23 0L23 1L25 1L25 2L26 2L26 3L25 3L25 4L24 4L24 5L25 5L25 6L24 6L24 7L23 7L23 5L22 5L22 4L23 4L23 3L24 3L24 2L23 2L23 3L22 3L22 2L21 2L21 3L22 3L22 4L19 4L19 3L20 3L20 1L22 1L22 0L18 0L18 1L17 1L17 0L13 0L13 1L12 1L12 0L11 0L11 1L12 1L12 2L10 2L10 0ZM32 0L32 1L33 1L33 0ZM15 1L15 2L14 2L14 3L13 3L13 2L12 2L12 5L10 5L10 6L11 6L11 7L12 7L12 5L13 5L13 7L14 7L14 8L15 8L15 7L16 7L16 9L17 9L17 10L18 10L18 11L17 11L17 12L16 12L16 11L15 11L15 9L13 9L13 13L12 13L12 11L11 11L11 12L10 12L10 13L9 13L9 14L8 14L8 12L7 12L7 13L6 13L6 14L5 14L5 15L6 15L6 16L8 16L8 17L5 17L5 18L7 18L7 19L8 19L8 20L10 20L10 21L9 21L9 22L8 22L8 21L6 21L6 22L8 22L8 23L6 23L6 24L9 24L9 22L10 22L10 23L11 23L11 27L10 27L10 28L11 28L11 29L10 29L10 30L13 30L13 31L12 31L12 33L14 33L14 32L19 32L19 33L15 33L15 34L16 34L16 35L14 35L14 36L16 36L16 37L17 37L17 38L16 38L16 39L15 39L15 40L16 40L16 39L17 39L17 38L18 38L18 39L20 39L20 37L21 37L21 36L22 36L22 37L23 37L23 38L24 38L24 39L25 39L25 38L26 38L26 36L28 36L28 37L27 37L27 38L28 38L28 37L29 37L29 38L30 38L30 39L31 39L31 38L30 38L30 37L32 37L32 36L31 36L31 35L32 35L32 32L33 32L33 31L32 31L32 32L30 32L30 31L31 31L31 30L32 30L32 28L30 28L30 29L28 29L28 31L26 31L26 33L25 33L25 30L23 30L23 31L22 31L22 30L21 30L21 29L22 29L22 28L23 28L23 27L22 27L22 26L20 26L20 27L22 27L22 28L21 28L21 29L20 29L20 28L19 28L19 29L18 29L18 28L17 28L17 30L18 30L18 31L16 31L16 30L15 30L15 31L14 31L14 29L15 29L15 28L16 28L16 27L15 27L15 26L18 26L18 27L19 27L19 25L20 25L20 24L21 24L21 23L22 23L22 22L21 22L21 23L20 23L20 24L19 24L19 23L18 23L18 25L17 25L17 23L14 23L14 22L18 22L18 21L14 21L14 20L16 20L16 19L17 19L17 20L19 20L19 22L20 22L20 20L19 20L19 19L21 19L21 20L22 20L22 21L23 21L23 22L24 22L24 20L23 20L23 19L25 19L25 22L27 22L27 21L26 21L26 19L25 19L25 18L26 18L26 15L24 15L24 13L25 13L25 14L26 14L26 13L27 13L27 14L28 14L28 15L27 15L27 16L28 16L28 15L29 15L29 18L27 18L27 20L28 20L28 19L29 19L29 18L30 18L30 19L31 19L31 17L32 17L32 16L31 16L31 17L30 17L30 15L33 15L33 14L34 14L34 15L35 15L35 14L36 14L36 15L37 15L37 14L36 14L36 13L35 13L35 12L34 12L34 13L33 13L33 14L32 14L32 11L31 11L31 10L32 10L32 8L31 8L31 7L30 7L30 6L29 6L29 5L28 5L28 4L27 4L27 3L28 3L28 2L27 2L27 3L26 3L26 4L25 4L25 5L27 5L27 8L26 8L26 6L25 6L25 8L26 8L26 9L25 9L25 10L24 10L24 8L23 8L23 7L22 7L22 5L18 5L18 3L19 3L19 1L18 1L18 2L16 2L16 1ZM14 3L14 4L15 4L15 5L14 5L14 7L15 7L15 6L16 6L16 7L17 7L17 6L18 6L18 7L19 7L19 8L20 8L20 10L22 10L22 11L18 11L18 12L21 12L21 13L19 13L19 14L20 14L20 15L18 15L18 14L16 14L16 12L15 12L15 11L14 11L14 12L15 12L15 13L14 13L14 16L13 16L13 20L14 20L14 19L16 19L16 18L17 18L17 19L18 19L18 18L17 18L17 17L18 17L18 16L20 16L20 15L21 15L21 14L22 14L22 15L23 15L23 14L22 14L22 13L23 13L23 12L24 12L24 11L23 11L23 8L22 8L22 9L21 9L21 8L20 8L20 7L21 7L21 6L20 6L20 7L19 7L19 6L18 6L18 5L17 5L17 6L16 6L16 3ZM28 6L28 8L27 8L27 9L26 9L26 10L25 10L25 12L26 12L26 11L27 11L27 9L29 9L29 6ZM4 9L4 10L5 10L5 9ZM6 9L6 10L7 10L7 11L10 11L10 10L9 10L9 9ZM11 9L11 10L12 10L12 9ZM30 9L30 10L31 10L31 9ZM22 11L22 12L23 12L23 11ZM28 11L28 12L27 12L27 13L28 13L28 14L29 14L29 15L30 15L30 14L31 14L31 13L30 13L30 14L29 14L29 11ZM30 11L30 12L31 12L31 11ZM2 13L2 15L4 15L4 14L3 14L3 13ZM34 13L34 14L35 14L35 13ZM6 14L6 15L8 15L8 16L9 16L9 15L8 15L8 14ZM10 14L10 16L11 16L11 17L9 17L9 18L8 18L8 19L10 19L10 20L11 20L11 19L10 19L10 18L12 18L12 15L13 15L13 14ZM15 15L15 16L18 16L18 15ZM24 16L24 18L25 18L25 16ZM35 16L35 18L36 18L36 19L35 19L35 20L36 20L36 19L37 19L37 16ZM20 17L20 18L22 18L22 19L23 19L23 18L22 18L22 17ZM0 19L0 20L1 20L1 19ZM10 21L10 22L11 22L11 21ZM12 21L12 22L13 22L13 21ZM40 21L40 22L39 22L39 23L40 23L40 24L41 24L41 21ZM12 23L12 25L14 25L14 26L15 26L15 25L16 25L16 24L14 24L14 23ZM28 23L28 24L27 24L27 25L28 25L28 24L29 24L29 23ZM34 23L34 24L36 24L36 25L37 25L37 26L38 26L38 27L39 27L39 26L38 26L38 25L39 25L39 24L37 24L37 23ZM0 25L0 26L1 26L1 25ZM9 25L9 26L10 26L10 25ZM40 25L40 26L41 26L41 25ZM12 26L12 27L13 27L13 26ZM14 27L14 28L15 28L15 27ZM4 28L4 29L5 29L5 28ZM12 28L12 29L13 29L13 28ZM19 29L19 30L20 30L20 31L19 31L19 32L20 32L20 33L19 33L19 34L20 34L20 33L21 33L21 34L22 34L22 35L23 35L23 36L26 36L26 35L28 35L28 36L29 36L29 35L30 35L30 34L29 34L29 33L28 33L28 32L29 32L29 31L30 31L30 30L31 30L31 29L30 29L30 30L29 30L29 31L28 31L28 32L27 32L27 34L24 34L24 35L23 35L23 33L21 33L21 32L22 32L22 31L21 31L21 30L20 30L20 29ZM39 29L39 30L40 30L40 29ZM3 30L3 31L4 31L4 30ZM13 31L13 32L14 32L14 31ZM37 32L37 33L38 33L38 34L39 34L39 33L38 33L38 32ZM33 33L33 36L36 36L36 33ZM17 34L17 35L16 35L16 36L17 36L17 37L18 37L18 36L21 36L21 35L18 35L18 34ZM34 34L34 35L35 35L35 34ZM35 37L35 38L36 38L36 37ZM21 38L21 39L22 39L22 38ZM39 38L39 39L40 39L40 40L41 40L41 39L40 39L40 38ZM36 39L36 40L37 40L37 39ZM27 40L27 41L28 41L28 40ZM0 0L0 7L7 7L7 0ZM1 1L1 6L6 6L6 1ZM2 2L2 5L5 5L5 2ZM34 0L34 7L41 7L41 0ZM35 1L35 6L40 6L40 1ZM36 2L36 5L39 5L39 2ZM0 34L0 41L7 41L7 34ZM1 35L1 40L6 40L6 35ZM2 36L2 39L5 39L5 36Z" fill="#000000"/></g></g></svg>';

        $image = SVG::fromString($svg);

        header('Content-Type: image/png');
        return $image;
    }
}
